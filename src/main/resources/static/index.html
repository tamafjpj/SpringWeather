<!doctype html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="style.css">
		<link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300" rel="stylesheet">
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
		<meta charset="utf-8">
	</head>
	<body>
			<h1>SpringWeather</h1>
			<h2>Выберите город для анализа</h2>
			<div class = "custom-select">
				<select>
					<option value = "0">Москва</option>
					<option value = "1">Владивосток</option>
					<option value = "2">Санкт-Петербург</option>
					<option value = "3">Казань</option>
					<option value = "4">Сочи</option>
				</select>
			</div>
			<h2>Выберите частоту обновления (минуты)</h2>
			<input align="center"></input>
			<h2>Выберите достоверный источник</h2>
			<div class = "custom-select">
				<select>
					<option value = "0">AccuWeather</option>
					<option value = "1">Yandex Погода</option>
					<option value = "2">Weather.com</option>
				</select>
			</div>
			<div class = "buttons">
				<button id = "clear">Очистить ввод</button>
				<button id ="complete">Выполнить запрос</button>
			</div>
			<br> <br>
			<div id = "weatherList"></div>
	</body>	

	<script>
		var selected = 0;
		$(".custom-select select").change(function () {
			selected = $(this).children("option:selected").val();
		});

		$("#complete").click(function () {
			var choice = "moscow";
			console.log(selected);
			$("#result").remove();
			$(".weatherCity").remove();
			switch (selected) {
				case '0': 
					choice = "";
					choice += "moscow";
				break;

				case '1':
					choice = "";
					choice +="vladivostok";
				break;
				
				case '2':
					choice = "";
					choice += "saint-petersburg";
				break;

				case '3':
					choice = "";
					choice += "kazan";
				break;

				case '4':
					choice = "";
					choice += "sochi"
				break;
				default:
		
			}
			var xmlhttp = new XMLHttpRequest();
			var txt = "";

			xmlhttp.onreadystatechange = function() {
			    if (this.readyState == 4 && this.status == 200) {
			        myObj = JSON.parse(this.responseText);
			            txt += "<h2 align = 'center' class = 'weatherCity'>Weather for " + choice + "</h2>"; 
			            txt += "<table id = 'result' border='1'>"
			            txt += "<thead><tr><th>Source</th><th>Temperature</th><th>Humidity</th><th>windSpeed</th></tr></thead>"
			            for (x in myObj) {
			                txt += "<tr><th>" + myObj[x].source + "</th>" + "<th>" + myObj[x].temp + "</th>" + "<th>" + myObj[x].humidity + "</th>" + "<th>"+ myObj[x].windSpeed + "</th></tr>";
			            }
			            txt += "</table>"
			            document.getElementById("weatherList").innerHTML = txt;
			    }
			};
			xmlhttp.open("GET", "http://localhost:8080/weather/"+choice+"", true);
			xmlhttp.send();	
		});

		$("#clear").click(function() {
			$("#result").remove();
			$(".weatherCity").remove();
		})
	</script>
</html>